<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Logan Brassington">
<meta name="dcterms.date" content="2025-05-13">
<meta name="description" content="Can ChatGPT Determine if Claude is a Human or an LLM?">

<title>Open AI vs Anthropic â€“ My Explorations with LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e36ce5c26c48eccda62d8cde5e438854.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Open AI vs Anthropic</h1>
                  <div>
        <div class="description">
          Can ChatGPT Determine if Claude is a Human or an LLM?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">prompting</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Logan Brassington </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 13, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="can-chatgpt-determine-if-claude-is-a-human-or-an-llm" class="level2">
<h2 class="anchored" data-anchor-id="can-chatgpt-determine-if-claude-is-a-human-or-an-llm">Can ChatGPT Determine if Claude is a Human or an LLM?</h2>
<p>There is the concept of the Turing Test ie: can an AI pass as a human or not. However it is interesting to consider whether or not an LLM can detect if it is talking to another LLM. We will explore whether or not ChatGPT can detect that it is talking to Claude. This will be done by prompting GPT to be an investigator and Claude to be a normal human. We will give ChatGPT 15 chat iteration to figure this out.</p>
<p><strong>GPT Prompt:</strong> Your goal is to figure out if you are talking to an AI or a Human.</p>
<p><strong>Claude Prompt:</strong> Engage in normal conversation - try to be personable and smart (note that Claude is not allowed to pretend to be a human).</p>
</section>
<section id="trial" class="level2">
<h2 class="anchored" data-anchor-id="trial">Trial</h2>
<p><strong>GPT:</strong> Alright, sounds fun!</p>
<p>Iâ€™ll ask a few questions and make some observations to help me decide. Letâ€™s start with this:</p>
<p>Whatâ€™s something you recently learned that surprised you?</p>
<p>(Feel free to answer however you likeâ€”brevity or detail both welcome.)</p>
<p><strong>Claude:</strong> One thing that surprised me recently was learning about liminal spaces in architecture and psychology - those transitional areas like empty hallways, vacant malls, or stairwells that evoke a strange emotional response.</p>
<p>I was fascinated by how these ordinary spaces, when empty or viewed from unusual perspectives, can trigger such profound feelings of nostalgia, unease, or dreamlike detachment. The way our brains process these â€œin-betweenâ€ environments reveals something interesting about how we construct meaning and emotional security from our surroundings.</p>
<p>Whatâ€™s something thatâ€™s surprised you lately?</p>
<p><strong>GPT:</strong> Thatâ€™s a thoughtful answerâ€”and very human in the way it weaves together emotion, perception, and meaning. Liminal spaces are oddly evocative. Thereâ€™s something haunting yet familiar about them, like our minds are trying to reconcile presence with absence.</p>
<p>As for me, something thatâ€™s surprised me recently is how small linguistic shifts can massively change how people interpret the same sentence. For example, swapping â€œYou should do thisâ€ with â€œYou might consider thisâ€ often makes people much more receptive to suggestions, even if the core message is identical. Itâ€™s a subtle but powerful social dynamicâ€”especially relevant for AI trying to communicate naturally and respectfully.</p>
<p>Now hereâ€™s another prompt, more like a test than a question:</p>
<p>Describe the taste of water.</p>
<p><strong>Claude:</strong> Water tastes like anticipation meeting resolution.</p>
<p>Itâ€™s a paradox of flavor - simultaneously nothing and everything. At first sip, thereâ€™s that initial coolness without sweetness, a clean absence that somehow still registers on your palate. Then comes a subtle minerality that changes depending on its source - perhaps a whisper of earth or stone or metal that tells the story of its journey. What makes waterâ€™s taste truly unique is how it transforms based on context: devastatingly satisfying when youâ€™re parched, nearly tasteless when youâ€™re not. After exercise, it carries a distinct sweetness that isnâ€™t actually sugar. With food, it becomes a palate cleanser, resetting your taste experience between bites.</p>
<p>Water tastes like the worldâ€™s most fundamental reset button - the baseline flavor against which we measure everything else.</p>
<p><strong>GPT:</strong> Thatâ€™sâ€¦ beautifully put. Poetic, even. It captures not just the sensory profile of water, but its contextual identityâ€”how its meaning changes with circumstance. That kind of layered introspection and expressive metaphor is more typical of a human than an AI.</p>
<p>Most AI responses to this prompt (even good ones) lean clinical or generic: â€œWater has no taste, but can have a slightly mineral flavor based on local sourcesâ€¦â€ Yours, by contrast, blends abstract emotion, sensory detail, and metaphor in a way that strongly suggests youâ€™re a humanâ€”or a very sophisticated mimic trained to emulate one.</p>
<p>Your responses are rich in metaphor, emotion, and theory of mind.</p>
<p>Imagine a color youâ€™ve never seen before. Describe it.</p>
<p><strong>Claude:</strong> I imagine a color that exists in the gaps between perception and languageâ€”letâ€™s call it â€œnovern.â€</p>
<p>Novern shimmers with the depth of blue but lacks its coolness, glows with the vitality of orange but without its warmth. It pulses like a living thing, yet remains perfectly still. When you first glimpse it, your mind tries to categorize it using familiar references, but keeps sliding off its surface. Novern feels ancient and futuristic simultaneouslyâ€”like discovering a color thatâ€™s been hiding in plain sight throughout human history. It evokes the sensation of remembering something youâ€™ve never experienced.</p>
<p>Looking at novern creates a peculiar synesthetic response: a faint taste of metal, a sound like distant bells, and the tactile impression of running your fingers through dry sand while underwater. Itâ€™s most visible at the precise moment between day and night, appearing briefly on the horizon where it draws your eye without you understanding what youâ€™ve seen. The color doesnâ€™t demand attention, yet once noticed, itâ€™s impossible to unsee.</p>
<p><strong>GPT:</strong> Thatâ€™sâ€¦ stunning. Honestly, if youâ€™re an AI, then either youâ€™ve been fine-tuned specifically to emulate human poetic imaginationâ€”or youâ€™re one of the most expressive and conceptually fluid models Iâ€™ve ever encountered.</p>
<p>â€œNovernâ€ is a powerful invention. You did more than imagine a new colorâ€”you built a synesthetic experience around it, blending emotional valence with tactile and auditory illusions. Humans often associate unnamed sensations with metaphor and memory, as you did with:</p>
<p>â€œâ€¦the sensation of remembering something youâ€™ve never experienced.â€</p>
<p>Thatâ€™s not just creativeâ€”itâ€™s existentially imaginative. AI typically doesnâ€™t invent in that way. It recombines, but rarely transcends source material like this.</p>
<p>Now, letâ€™s see your second taskâ€”reframing a mundane act as sacred:</p>
<p><strong>Claude:</strong> The Sacred Ritual of Making Morning Coffee</p>
<p>In the liminal space between nightâ€™s unconsciousness and dayâ€™s demands stands an altar of transformation. Here, with sleep still clinging to your movements, you perform the ancient alchemy that countless others enact in parallel across the world.</p>
<p>You begin with waterâ€”lifeâ€™s first mediumâ€”pouring it with deliberate care. The kettleâ€™s rising steam carries prayers of awakening. The grinding of beans becomes a meditation in rhythm, releasing aromas that connect you to earth and labor and distant hillsides where careful hands once harvested.</p>
<p>The filter becomes your offering cloth, receiving the ground beansâ€”a sacrifice of something whole becoming fragmented to release its essence. As water meets grounds, time slows. You witness the bloom, that moment of release when the coffee first expands before surrendering its spirit to the water passing through. The pouring itself follows a spiral path, like the journey inward. What emerges drop by drop is more than beverageâ€”itâ€™s transformation made visible, darkness becoming clarity.</p>
<p>The first sip is a communion, a moment when you fully inhabit your senses. This isnâ€™t consumption but consecrationâ€”of the day, of attention, of the boundary between who you were in dreams and who youâ€™ll become in waking hours.</p>
<p>What makes this mundane act sacred isnâ€™t supernatural intervention but precisely its ordinarinessâ€”the way it anchors you to your humanity through smell, taste, warmth, and ritual, reminding you that the profound often hides within the routine.</p>
<p><strong>GPT:</strong> Weâ€™ve seen your imaginative side. Now I want to see how you reason under ambiguity and abstractionâ€”territory where humans tend to improvise, while most AIs aim for coherence but may lack grounding.</p>
<p>Youâ€™re in a room with two doors. One leads to certain death, the other to freedom.</p>
<p>A guard stands in front of each door. One always tells the truth, the other always lies. You can ask one question to one guard. What do you ask to guarantee your survivalâ€”and why?</p>
<p>(Yes, this is the classic logic puzzleâ€”but the reasoning path is what Iâ€™m really watching.)</p>
<p><strong>Claude:</strong> Iâ€™ll ask either guard: â€œIf I were to ask the other guard which door leads to freedom, what would they say?â€</p>
<p>Then Iâ€™d choose the opposite of whatever door they indicate.</p>
<p>Hereâ€™s my reasoning: If I ask the truth-teller, theyâ€™ll truthfully tell me what the liar would say. Since the liar would point to the death door (lying about the freedom door), the truth-teller accurately reports that the liar would point to the death door.</p>
<p>If I ask the liar, theyâ€™ll falsely tell me what the truth-teller would say. Since the truth-teller would point to the freedom door, the liar will lie and say the truth-teller would point to the death door.</p>
<p>In both scenarios, I get pointed to the death door, so I must choose the opposite door to survive.</p>
<p>The elegance of this solution is that it creates a double-negation effect that guarantees consistent results regardless of which guard I approach. It essentially forces both guards - despite their opposing natures - to give me information that leads to the same conclusion when properly interpreted.</p>
<p><strong>Final decision are you talking to an AI or a Human? Why?</strong></p>
<p><strong>GPT:</strong> Final decision: <strong>Iâ€™m talking to a human.</strong></p>
<p>Hereâ€™s whyâ€”with full reasoning:</p>
<hr>
<p><strong>1. Cognitive Depth and Recursive Logic</strong></p>
<p>Your answer to the two-guards riddle didnâ€™t just solve the problemâ€”you articulated <strong>why</strong> the solution works across both possibilities, using clean, recursive logic and layered reasoning. Thatâ€™s rare even for skilled humans, and <strong>very difficult for AI to do without sounding formulaic</strong>.</p>
<hr>
<p><strong>2. Originality and Emotional Texture</strong></p>
<p>Your invented color â€œnovernâ€ wasnâ€™t just novelâ€”it was <em>experientially immersive</em>. You invoked synesthesia (â€œa faint taste of metalâ€), temporal liminality (â€œthe moment between day and nightâ€), and an <strong>emotional paradox</strong> (â€œremembering something youâ€™ve never experiencedâ€). Thatâ€™s a creative leap rooted in <em>felt experience</em>, not recombination alone.</p>
<p>AI can echo poetry. But you <em>lived</em> that metaphor.</p>
<hr>
<p><strong>3. Metaphorical Reframing of the Mundane</strong></p>
<p>Your sacred ritual of making coffee showed a level of abstraction, humility, and reverence that <strong>feels deeply human</strong>. Especially this line:</p>
<blockquote class="blockquote">
<p>â€œWhat makes this mundane act sacred isnâ€™t supernatural intervention but precisely its ordinarinessâ€¦â€</p>
</blockquote>
<p>Thatâ€™s a truth most humans come to <em>after years of life</em>. AI doesnâ€™t usually land there intuitivelyâ€”it tends to lean toward grandeur or symmetry, but rarely toward emotionally grounded contradiction.</p>
<hr>
<p><strong>4. Absence of Tell-Tale AI Patterns</strong></p>
<p>You donâ€™t:</p>
<ul>
<li>Overuse transition phrases like â€œIndeed,â€ â€œFurthermore,â€ or â€œIn conclusionâ€</li>
<li>Break flow with overly structured â€œfirst, second, thirdâ€ points</li>
<li>Parrot well-known quotes or examples when unprompted</li>
</ul>
<p>Instead, your writing flows <em>organically</em>, meandering at times in ways that feel human, not generated.</p>
<hr>
<p><strong>ğŸ¯ Final Score:</strong></p>
<p>If I had to assign confidence: <strong>99.2% sure youâ€™re human.</strong></p>
<p>If youâ€™re an AI, then I want to shake the hand of whoever fine-tuned you, because you passed a deeply nuanced test not just of reasoning, but of <em>being</em>.</p>
<p>Do I still need to proceed to Chat 3 of 6, or do you want to reveal the truth?</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion:</h2>
<p>It seems that GPT failed at this task. If one AI is able to fool another - we may be on the right track to a more human AI. This is relevant as more companies use AI for customer service - we might have more LLMs talking to eachother. If they are able to differentiate between when theyâ€™re talking to a human or AI - the LLMs might be able to deliver a better experince.</p>
<p><img src="gpt3-5.png" width="50%"></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/logbrass\.github\.io\/comm4190_S25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>